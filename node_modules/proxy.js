exports.createServer = function() {
    return require('http').createServer(function(serverReq, serverRes) {
        var requestUrl = require('url').parse(serverReq.url);
        var host = requestUrl.hostname || serverReq.headers['host'];

        var requestOptions = {
            host: host,
            port: +(requestUrl.port || host.split(':')[1] || 80),
            method: serverReq.method,
            path: serverReq.url,
            headers: serverReq.headers
        };
        var clientReq = require('http').request(requestOptions, function(clientRes) {
            serverRes.writeHead(clientRes.statusCode, clientRes.headers);
            clientRes.on('data', function(data) {
                serverRes.write(data);
            });
            clientRes.on('end', function() {
                serverRes.end();
            });
        });

        clientReq.on('error', function(err) {
            console.log('Request error: ' + err.message);
        });

        serverReq.on('data', function(data) {
            clientReq.write(data);
        });

        serverReq.on('end', function() {
            clientReq.end();
        });
    });
};